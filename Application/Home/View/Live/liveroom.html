<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 兼容国产浏览器的高速模式 -->
    <title>Goto.live直播间</title>
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="__PUBLIC__/Home/css/normalize.css"/>
    <link rel="stylesheet" href="__PUBLIC__/Home/css/main.css"/>
    <script src="__PUBLIC__/Home/js/html5shiv.min.js"></script>
    <script src="__PUBLIC__/Home/js/respond.src.js"></script>
    <script src="__PUBLIC__/Home/data/laydate/laydate.js"></script>
</head>
<body>
    <!--nav part-->
    <div class="navbar-default hidden-xs">
        <div class="container">
            <div class="row">
                <!--logo-->
                <a class="hidden-xs" >
                    <div class="brand"></div>
                </a>
                <a class="hidden-xs brandBox">
                    <!--<div class="brand2"></div>-->
                </a>
            </div>
        </div>
        <div class=" navLine"></div>
    </div>
    <nav id="navPart" class="nav navbar-default navbar-fixed-top">
        <div class="container" role="navigation">
            <div class="row">
                <!--pc端-->
                <div id="navBox" class="navbar-collapse collapse">
                    <ul class="nav navbar  noMargin">
                        <li class="dropdown  dropBoxLine col-lg-2 col-md-2 col-sm-2 hidden-xs">
                            <span class="leftBoxline hidden-xs"></span>
                            <a href="#" data-toggle="dropdown" class="dropdown-toggle drop_link">
                                <span class="locoLogo"></span>{$cname}
                            </a>
                            <ul class="dropdown-menu">
                                <foreach name='citys' item='cv'>
                                    <li><a href="{:U('Home/Live/liveRoom',['cid'=>$cv['qy_id']])}">{$cv['qy_name']}</a></li>
                                </foreach>
                            </ul>
                        </li>
                        <!--菜单选项-->
                        <li class="col-lg-2 col-md-2 col-sm-2 titleLine">
                            <a href="{:U('Index/index')}" class="navSet_txt">
                                首页
                                <p class="navSet_txt_sub">HOME</p>
                            </a>
                        </li>
                        <li class="col-lg-2 col-md-2 col-sm-2 titleLine">
                            <a href="{:U('Live/liveRoom')}" class="navSet_txt pageTitleActive">
                                直播间
                                <p class="navSet_txt_sub">LIVE SHOW</p>
                            </a>
                        </li>
                        <li class="col-lg-2 col-md-2 col-sm-2 titleLine">
                            <a href="{:U('Live/wonderful')}" class="navSet_txt">
                                精选视频
                                <p class="navSet_txt_sub">WONDERFUL</p>
                            </a>
                        </li>
                        <li class="col-lg-2 col-md-2 col-sm-2 titleLine">
                            <a href="http://www.yicehua.cn" class="navSet_txt">
                                商城
                                <p class="navSet_txt_sub">THE MALL</p>
                            </a>
                        </li>
                        <li class="col-lg-2 col-md-2 col-sm-2 titleLine">
                            <a href="{:U('User/personal_center_view')}" class="navSet_txt ">
                                个人中心
                                <p class="navSet_txt_sub">PERSONAL</p>
                            </a>
                        </li>
                    </ul>
                </div>
                <!--移动端--><!--移动端代码位于pc下部，可出现导航条上不折叠菜单-->
                <div class="navbar-header mo-navBg">
                    <div class="navbar-left dropdown mo-navBg-title visible-xs-inline-block">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle drop_link2">
                            <span class="locoLogo2"></span>{$cname}<span class="caret leftMore"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <foreach name='citys' item='cv'>
                                    <li><a href="{:U('Home/Live/liveRoom',['cid'=>$cv['qy_id']])}">{$cv['qy_name']}</a></li>
                                </foreach>
                        </ul>
                    </div>
                    <!--移动端中心logo-->
                    <div class="mo-navLogo visible-xs">
                        <div class="mo-navLogo_sub1"></div>
                        <!--<div class="mo-navLogo_sub2"></div>-->
                    </div>

                    <button type="button" class="navbar-toggle mo-navBtn" data-toggle="collapse" data-target="#navBox">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar mo-navBtnSub"></span>
                    </button>

                </div>
            </div>
        </div>
    </nav>
    <!--nav end-->
    <!--main part-->
    <section>
        <!--主图展示部分-->
        <div class="container-fluid L-mainImg hidden-xs"></div>
        <div class="container-fluid L-mainImg-xs visible-xs"></div>
        <!--live show-->
        <div class="container-fluid showPartBg">
            <div class="container sm-addPadd L-addMar ms-controller" ms-controller="videos">
                <div class="row">
                    <div class="L-liveTitle" >
                        <span>直播间</span>
                        <em class="L-liveTitleSub2">LIVE SHOW</em>           
                        <!--pc时间选择-->
                        <div class="L-liveTitleDate hidden-xs">
                            <form method="GET" action="{:U('Live/liveRoom')}">
                                选择时间段：
                                <input id="L-dateBox" placeholder="请输入日期" name="stardate" class="laydate-icon L-dateBoxType" ms-duplex="@startDate">
                                <em class="dateBox-offLine">-</em>
                                <input id="L-dateBox2" placeholder="请输入日期" name="enddate" class="laydate-icon L-dateBoxType" ms-duplex="@endDate">
                                <button id="L_dateDone" type="submit" class="btn btn-default L-dateDone">确定</button>
                                <!--日期选择调用JS，见下JS代码-->
                            </form>
                        </div>
                        <div class="L-liveTitleDate-xs visible-xs">
                            <div class="L-dateBox-label" data-toggle="modal" data-target=".bs-example-modal-lg-date">时间筛选&nbsp;<span class="caret"></span></div>
                        </div>
                        <!--移动端时间选择-->
                        <div id="model-dateBox" class="modal fade bs-example-modal-lg-date" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg noMargR noMargL">
                                <div class="modal-content my-modal-content model-dateBox">
                                    <div id="dateBox_xs">
                                        <div class="L-liveTitle L-liveTitle-dateWindow">
                                            <span>直播间</span>
                                            <em class="L-liveTitleSub2">LIVE SHOW</em>
                                            <div class="L-dateBox-label L-liveTitle-dateFakeBtn" >时间筛选&nbsp;<span class="caret"></span></div>
                                        </div>
                                        <form method="GET" action="{:U('Live/liveRoom')}">
                                            选择时间段：
                                            <input id="L-dateBox3" placeholder="请输入日期" name="stardate" readonly class="laydate-icon L-dateBoxType" ms-duplex="@startDate" >
                                            <em class="dateBox-offLine">-</em>
                                            <input id="L-dateBox4" placeholder="请输入日期" name="enddate" readonly class="laydate-icon L-dateBoxType" ms-duplex="@endDate" >
                                            <p>
                                                <button id="L-dateReset" class="btn btn-default L-dateDone-xs noMargL" type="submit">重置</button>
                                                <button id="L-dateDone-xs" class="btn btn-default L-dateDone-xs L-dateDoneBg-xs noMargR" type="submit">确定</button>
                                            </p>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6 L-liveShowBox" ms-for="el in @data">
                    	
                        <a ms-attr="{href:el.url}"><!--vm对象hrefAddr传值-->
                            <div id="imageBox">
                                <img ms-attr="{src:el.imgSrc}" class="img-responsive showSubImg"/>
                            </div>
                        </a>
                        <p class="single_text showSubTxtTitle showSubTxtTitle2 center L-liveShowTxt" >
                            <em ms-text="el.title"></em>
                            <span class="L-showSubTxtdate" ms-text="el.date"></span>
                            <span class="L-liveCount">直播倒计时：<b>{{el.countTime}}</b></span>
                        </p>
                    </div>
                </div>
                
                <div class="row">
                    <button class="btn btn-default btn-lg moreBtn center-block">点击加载更多</button>
                </div>
                
            </div>
        </div>
    </section>
    <footer class="container-fluid showPartBg hidden-xs">
        <div class="container ">
            <div class="row">
                <div class="col-lg-2 col-md-2 col-sm-2 hidden-xs">
                    <div class="footer-logo"></div>
                </div>
                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12 footer-txt noPaddRL">
                    <p class="small-Block">证婚直播LIVE&nbsp;&nbsp;版权所有&nbsp;&nbsp;<span>京ICP备15015202号-3&nbsp;&nbsp;</span><span class="small-Block">联系电话:010-89468899</span></p>
                    <span class="small-Block">© 2005-2016 zhenghun.yicehua.cn, All rights reserved.</span>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2 hidden-xs">
                    <div class="QR_Code"></div>
                </div>
            </div>
        </div>
    </footer>

    <script src="__PUBLIC__/Home/js/jquery-1.11.3.js"></script>
    <script src="__PUBLIC__/Home/js/bootstrap.min.js"></script>
    <script src="__PUBLIC__/Home/js/addfunction.js"></script>
    <script src="__PUBLIC__/Home/js/avalon.js"></script>
    <script>
        /***数据绑定部分****/

        //TODO:视频
        var videos=avalon.define({
            $id:"videos",
            startDate:'',
            endDate:'', //时间段数据
            data:[
              	/*{imgSrc:'__PUBLIC__/Home/img/hl_1_15.png',title:'美好美好美好',date:'2015-06',countTime:'2016/10/13 19:18:00'},
                {imgSrc:'__PUBLIC__/Home/img/hl_1_15.png',title:'美好美好美好',date:'2015-06',countTime:'2016/10/14 19:18:00'},
                {imgSrc:'__PUBLIC__/Home/img/hl_1_15.png',title:'美好美好美好',date:'2015-06',countTime:'2016/10/29 19:18:00'},
                {imgSrc:'__PUBLIC__/Home/img/hl_1_15.png',title:'美好美好美好',date:'2015-06',countTime:'2016/10/14 19:18:00'}*/
            ]
        });

        //一开始判断加载的话，是否还有数据
        $(function () {
            if({$userModel}.data==""){
                $('.moreBtn').text('暂无数据！').addClass('disabledbtn');
                //$(".moreBtn").attr("disabled", true);
            }else if({$num}==0){
                $('.moreBtn').text('没有更多视频了').addClass('disabledbtn');
            }
            for(var key in {$userModel}.data ){
                videos.data.push({$userModel}.data[key]);
            }
        });
        /*for(var key in {$userModel}.data ){
            videos.data.push({$userModel}.data[key]);
        }
        if({$userModel}.data==""){
        	$('.moreBtn').text('暂无数据');
            $(".moreBtn").attr("disabled", true);
        }*/

        
        //Todo：时间操作功能
            /**移动端时：**/
                /*重置按钮*/
            function filterdone(){
                $("#L-dateBox3").val('');
                $("#L-dateBox4").val('');
            }
            $("#L-dateReset").on('click', function() {
                filterdone();
            });
              

        //TODO:加载更多
        	var page = 2,stardate="{$stardate}",enddate="{$enddate}",cid="{$cid}";
            $('.moreBtn').on('click', function () {
                if(!$(this).hasClass('disabledbtn')){
                    jQuery.ajax({
                        method: "GET",
                        url: "{:U('Live/ajaxGetLists')}",
                        data:{page:page,stardate:stardate,enddate:enddate,cid:cid},
                        dataType:'json',
                        success: function (data) { 
                            avalon.each(data.data, function (k,v) {
                                    videos.data.push(v);
                                    LiveCountdown($(".L-liveCount").eq(-1).children());
                            });
                            page++;
                            if(data.num==0){    
                                $('.moreBtn').text('没有更多视频了').addClass('disabledbtn');
                            }
                        }
                    });
                }
            });

            //一开始判断加载的话，是否还有数据
           /* function checkMore(){
                jQuery.ajax({
                    method: "GET",
                    url: "{:U('Live/ajaxGetLists')}",
                    data:{page:page,stardate:stardate,enddate:enddate},
                    dataType:'json',
                    success: function (data) {
                        if(data.data==''){
                            $('.moreBtn').css('display','none');
                        }
                    }
                });
            }
            checkMore();*/

        //TODO:直播倒计时
        window.onload= function () {
            LiveCountdown($(".L-liveCount b"));
            menuFixed('navPart');
        };
        function LiveCountdown(elems){
        	elems.each(function(){
                var target=this;
                var data=new Date(this.innerHTML);
                var timer=null;
                timer=setInterval(function () {
                    var nowTime=new Date();
                    var s=(data-nowTime)/1000;
                    if(s>=0){
                        var h=parseInt(s/3600);
                        h<10&&(h='0'+h);
                        var m=parseInt(s%3600/60);
                        m<10&&(m='0'+m);
                        s=parseInt(s%60);
                        s<10&&(s='0'+s);
                        if(h<=48){
                            target.innerHTML=target.innerHTML.indexOf(":")==-1?h+":"+m+":"+s:h+"  "+m+"  "+s;
                        }else{
                            target.innerHTML='还有'+parseInt(h/24)+"天";
                        }
                    } else{
                        clearInterval(timer);
                        timer=null;
                        target.parentNode.textContent='直播已开始！';
                    } 
                },500);
            });
        }
        

    </script>
    <script>
        /***观看视频日期选择器的JS调用设置代码***/
                /*！！注意：该插件源码已修改*/
        var filterDatestart1 = {
            elem: '#L-dateBox',
            format: 'YYYY-MM-DD',
            min: '2016-01-01', //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            istoday: false,
            issure: false,
            isclear:false,
            choose: function(datas){
                filterDatestart1.min = datas; //开始日选好后，重置结束日的最小日期
                filterDatestart1.start = datas; //将结束日的初始值设定为开始日
            }
        };
        var filterDateend1 = {
            elem: '#L-dateBox2',
            format: 'YYYY-MM-DD',
            min: '2016-01-01',
            max: '2099-06-16',
            istoday: false,
            issure: false,
            isclear:false,
            choose: function(datas){
                filterDateend1.max = datas; //结束日选好后，重置开始日的最大日期
            }
        };
        var filterDatestart2 = {
            elem: '#L-dateBox3',
            format: 'YYYY-MM-DD',
            min: '2016-01-01', //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            istoday: false,
            issure: false,
            isclear:false,
            choose: function(datas){
                filterDatestart2.min = datas; //开始日选好后，重置结束日的最小日期
                filterDatestart2.start = datas; //将结束日的初始值设定为开始日
            }
        };
        var filterDateend2 = {
            elem: '#L-dateBox4',
            format: 'YYYY-MM-DD',
            min: '2016-01-01',
            max: '2099-06-16',
            istoday: false,
            issure: false,
            isclear:false,
            choose: function(datas){
                filterDateend2.max = datas; //结束日选好后，重置开始日的最大日期
            }
        };
        laydate(filterDatestart1);
        laydate(filterDateend1);
        laydate(filterDatestart2);
        laydate(filterDateend2);

        
        var  img_url = "{$img_responsive[5]['big_img']}";
        var  img_url1 = "{$img_responsive[5]['small_img']}";
        $('.L-mainImg').css({'background':"url("+img_url+") center ","backgroundSize":"cover"});
        $('.L-liveTitleSub2').on('click', function () {console.log('Just a test--YJ~');});
        $('.L-mainImg-xs').css({'background':"url("+img_url+") center","backgroundSize":"cover"});


    </script>
</body>
</html>